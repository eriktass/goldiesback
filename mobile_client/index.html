<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="GitHub Repository Explorer - Search and analyze GitHub repositories on mobile and Chromebook">
    <title>GitHub Explorer Mobile</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#24292e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="GitHub Explorer">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2324292e' d='M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.606 9.606 0 0112 6.82c.85.004 1.705.114 2.504.336 1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48C19.137 20.107 22 16.373 22 11.969 22 6.463 17.522 2 12 2z'/%3E%3C/svg%3E">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.5;
            color: #24292e;
            background-color: #ffffff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }
        
        /* Header */
        .header {
            background: #24292e;
            color: white;
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-form {
            display: flex;
            flex: 1;
            max-width: 600px;
            margin: 0 24px;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e1e4e8;
            border-radius: 8px 0 0 8px;
            font-size: 16px;
            outline: none;
        }
        
        .search-input:focus {
            border-color: #0366d6;
        }
        
        .search-button {
            padding: 12px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-size: 16px;
        }
        
        .search-button:hover {
            background: #218838;
        }
        
        /* Main Content */
        .main {
            padding: 24px 0;
            min-height: calc(100vh - 140px);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e1e4e8;
            border-top: 4px solid #0366d6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .results-count {
            font-size: 18px;
            color: #586069;
        }
        
        .view-toggle {
            display: flex;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .view-button {
            padding: 8px 12px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        
        .view-button.active {
            background: #0366d6;
            color: white;
        }
        
        /* Repository Grid */
        .repo-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .repo-grid.list-view {
            grid-template-columns: 1fr;
        }
        
        .repo-grid.grid-view {
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }
        
        .repo-card {
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
            background: white;
            transition: box-shadow 0.2s, transform 0.2s;
            cursor: pointer;
        }
        
        .repo-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .repo-header {
            display: flex;
            align-items: start;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .repo-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .repo-info {
            flex: 1;
            min-width: 0;
        }
        
        .repo-name {
            font-size: 18px;
            font-weight: bold;
            color: #0366d6;
            text-decoration: none;
            word-break: break-all;
        }
        
        .repo-name:hover {
            text-decoration: underline;
        }
        
        .repo-owner {
            color: #586069;
            font-size: 14px;
        }
        
        .repo-description {
            margin: 12px 0;
            color: #586069;
            line-height: 1.4;
        }
        
        .repo-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: #586069;
            flex-wrap: wrap;
        }
        
        .repo-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .language-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        /* Topics */
        .topics {
            margin: 12px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .topic {
            background: #f1f8ff;
            color: #0366d6;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            text-decoration: none;
        }
        
        .topic:hover {
            background: #e1f4ff;
        }
        
        /* Error State */
        .error {
            text-align: center;
            padding: 40px;
            color: #d73a49;
        }
        
        .error-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #586069;
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 32px 0;
        }
        
        .page-button {
            padding: 8px 16px;
            border: 1px solid #e1e4e8;
            background: white;
            color: #0366d6;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .page-button:hover {
            background: #f6f8fa;
        }
        
        .page-button.active {
            background: #0366d6;
            color: white;
        }
        
        .page-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }
            
            .search-form {
                margin: 0 12px;
            }
            
            .repo-grid.grid-view {
                grid-template-columns: 1fr;
            }
            
            .results-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .repo-meta {
                gap: 12px;
            }
            
            .search-input {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }
        
        /* Chromebook optimizations */
        @media (min-width: 1200px) {
            .repo-grid.grid-view {
                grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #0d1117;
                color: #c9d1d9;
            }
            
            .repo-card {
                background: #161b22;
                border-color: #30363d;
            }
            
            .search-input {
                background: #21262d;
                border-color: #30363d;
                color: #c9d1d9;
            }
            
            .view-button {
                background: #21262d;
                color: #c9d1d9;
                border-color: #30363d;
            }
            
            .page-button {
                background: #21262d;
                border-color: #30363d;
                color: #58a6ff;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.477 2 2 6.463 2 11.97c0 4.404 2.865 8.14 6.839 9.458.5.092.682-.216.682-.48 0-.236-.008-.864-.013-1.695-2.782.602-3.369-1.337-3.369-1.337-.454-1.151-1.11-1.458-1.11-1.458-.908-.618.069-.606.069-.606 1.003.07 1.531 1.027 1.531 1.027.892 1.524 2.341 1.084 2.91.828.092-.643.35-1.083.636-1.332-2.22-.251-4.555-1.107-4.555-4.927 0-1.088.39-1.979 1.029-2.675-.103-.252-.446-1.266.098-2.638 0 0 .84-.268 2.75 1.022A9.606 9.606 0 0112 6.82c.85.004 1.705.114 2.504.336 1.909-1.29 2.747-1.022 2.747-1.022.546 1.372.202 2.386.1 2.638.64.696 1.028 1.587 1.028 2.675 0 3.83-2.339 4.673-4.566 4.92.359.307.678.915.678 1.846 0 1.332-.012 2.407-.012 2.734 0 .267.18.577.688.48C19.137 20.107 22 16.373 22 11.969 22 6.463 17.522 2 12 2z"/>
                    </svg>
                    GitHub Explorer
                </div>
                <form class="search-form" id="searchForm">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="Search repositories..."
                        autocomplete="off"
                        required
                    >
                    <button type="submit" class="search-button">Search</button>
                </form>
            </div>
        </div>
    </header>
    
    <main class="main">
        <div class="container">
            <div id="app">
                <div class="empty-state">
                    <div class="empty-state-icon">🔍</div>
                    <h2>Search GitHub Repositories</h2>
                    <p>Enter a search term to find repositories, users, or topics</p>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // Configuration - Flask Python backend
        const API_BASE = window.location.origin.replace(':5000', ':5001') + '/api';
        
        // DOM Elements
        const app = document.getElementById('app');
        const searchForm = document.getElementById('searchForm');
        const searchInput = document.getElementById('searchInput');
        
        // State
        let currentQuery = '';
        let currentPage = 1;
        let viewMode = 'list';
        let isLoading = false;
        
        // Language colors
        const languageColors = {
            javascript: '#f1e05a',
            typescript: '#3178c6',
            python: '#3572a5',
            java: '#b07219',
            go: '#00add8',
            rust: '#dea584',
            cpp: '#f34b7d',
            c: '#555555',
            html: '#e34c26',
            css: '#563d7c',
            php: '#4f5d95',
            ruby: '#701516',
            swift: '#fa7343',
            kotlin: '#a97bff',
            shell: '#89e051',
        };
        
        // Utility functions
        function formatNumber(num) {
            if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;
            if (num >= 1000) return `${(num / 1000).toFixed(1)}k`;
            return num.toString();
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        function getLanguageColor(language) {
            return languageColors[language?.toLowerCase()] || '#586069';
        }
        
        // API functions
        async function searchRepositories(query, page = 1) {
            const params = new URLSearchParams({
                q: query,
                page: page.toString(),
                per_page: '30'
            });
            
            const response = await fetch(`${API_BASE}/search/repositories?${params}`);
            if (!response.ok) {
                throw new Error(`Search failed: ${response.statusText}`);
            }
            
            return response.json();
        }
        
        // UI Rendering
        function renderLoading() {
            app.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Searching repositories...</p>
                </div>
            `;
        }
        
        function renderError(message) {
            app.innerHTML = `
                <div class="error">
                    <div class="error-icon">⚠️</div>
                    <h2>Search Error</h2>
                    <p>${message}</p>
                </div>
            `;
        }
        
        function renderRepository(repo) {
            const topics = repo.topics?.slice(0, 5).map(topic => 
                `<a href="#" class="topic" data-topic="${topic}">${topic}</a>`
            ).join('') || '';
            
            return `
                <div class="repo-card" data-repo="${repo.full_name}">
                    <div class="repo-header">
                        <img src="${repo.owner.avatar_url}" alt="${repo.owner.login}" class="repo-avatar">
                        <div class="repo-info">
                            <a href="${repo.html_url}" target="_blank" class="repo-name" rel="noopener">
                                ${repo.full_name}
                            </a>
                            <div class="repo-owner">by ${repo.owner.login}</div>
                        </div>
                    </div>
                    
                    ${repo.description ? `<div class="repo-description">${repo.description}</div>` : ''}
                    
                    ${topics ? `<div class="topics">${topics}</div>` : ''}
                    
                    <div class="repo-meta">
                        ${repo.language ? `
                            <div class="repo-stat">
                                <span class="language-dot" style="background-color: ${getLanguageColor(repo.language)}"></span>
                                ${repo.language}
                            </div>
                        ` : ''}
                        
                        <div class="repo-stat">
                            ⭐ ${formatNumber(repo.stargazers_count)}
                        </div>
                        
                        <div class="repo-stat">
                            🍴 ${formatNumber(repo.forks_count)}
                        </div>
                        
                        ${repo.updated_at ? `
                            <div class="repo-stat">
                                Updated ${formatDate(repo.updated_at)}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        function renderResults(data) {
            const { total_count, repositories } = data;
            
            if (repositories.length === 0) {
                app.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🔍</div>
                        <h2>No repositories found</h2>
                        <p>Try a different search term or check your spelling</p>
                    </div>
                `;
                return;
            }
            
            const resultsHtml = `
                <div class="results-header">
                    <div class="results-count">
                        ${formatNumber(total_count)} repositories found
                    </div>
                    <div class="view-toggle">
                        <button class="view-button ${viewMode === 'list' ? 'active' : ''}" data-view="list">
                            📋 List
                        </button>
                        <button class="view-button ${viewMode === 'grid' ? 'active' : ''}" data-view="grid">
                            ⚏ Grid
                        </button>
                    </div>
                </div>
                
                <div class="repo-grid ${viewMode}-view">
                    ${repositories.map(renderRepository).join('')}
                </div>
                
                ${total_count > repositories.length ? renderPagination(total_count) : ''}
            `;
            
            app.innerHTML = resultsHtml;
            
            // Add event listeners
            addResultEventListeners();
        }
        
        function renderPagination(totalCount) {
            const totalPages = Math.ceil(totalCount / 30);
            const maxPages = Math.min(totalPages, 10);
            
            let paginationHtml = '<div class="pagination">';
            
            if (currentPage > 1) {
                paginationHtml += `<button class="page-button" data-page="${currentPage - 1}">← Previous</button>`;
            }
            
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(maxPages, currentPage + 2); i++) {
                paginationHtml += `
                    <button class="page-button ${i === currentPage ? 'active' : ''}" data-page="${i}">
                        ${i}
                    </button>
                `;
            }
            
            if (currentPage < totalPages) {
                paginationHtml += `<button class="page-button" data-page="${currentPage + 1}">Next →</button>`;
            }
            
            paginationHtml += '</div>';
            return paginationHtml;
        }
        
        function addResultEventListeners() {
            // View toggle
            document.querySelectorAll('.view-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    viewMode = e.target.dataset.view;
                    const grid = document.querySelector('.repo-grid');
                    grid.className = `repo-grid ${viewMode}-view`;
                    
                    document.querySelectorAll('.view-button').forEach(btn => 
                        btn.classList.remove('active')
                    );
                    e.target.classList.add('active');
                });
            });
            
            // Pagination
            document.querySelectorAll('.page-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const page = parseInt(e.target.dataset.page);
                    if (page !== currentPage) {
                        currentPage = page;
                        performSearch();
                    }
                });
            });
            
            // Topic search
            document.querySelectorAll('.topic').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const topic = e.target.dataset.topic;
                    searchInput.value = topic;
                    currentQuery = topic;
                    currentPage = 1;
                    performSearch();
                });
            });
        }
        
        // Search functionality
        async function performSearch() {
            if (!currentQuery || isLoading) return;
            
            isLoading = true;
            renderLoading();
            
            try {
                const data = await searchRepositories(currentQuery, currentPage);
                renderResults(data);
            } catch (error) {
                console.error('Search error:', error);
                renderError(error.message);
            } finally {
                isLoading = false;
            }
        }
        
        // Event listeners
        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (query) {
                currentQuery = query;
                currentPage = 1;
                performSearch();
            }
        });
        
        // URL handling for back/forward navigation
        function updateURL() {
            const params = new URLSearchParams();
            if (currentQuery) params.set('q', currentQuery);
            if (currentPage > 1) params.set('page', currentPage.toString());
            
            const newURL = `${window.location.pathname}${params.toString() ? '?' + params.toString() : ''}`;
            window.history.pushState({ query: currentQuery, page: currentPage }, '', newURL);
        }
        
        window.addEventListener('popstate', (e) => {
            if (e.state) {
                currentQuery = e.state.query || '';
                currentPage = e.state.page || 1;
                searchInput.value = currentQuery;
                if (currentQuery) {
                    performSearch();
                }
            }
        });
        
        // Initialize from URL
        const urlParams = new URLSearchParams(window.location.search);
        const initialQuery = urlParams.get('q');
        if (initialQuery) {
            searchInput.value = initialQuery;
            currentQuery = initialQuery;
            currentPage = parseInt(urlParams.get('page')) || 1;
            performSearch();
        }
        
        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>